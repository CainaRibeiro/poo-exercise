<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../styles/style.css">
    <link rel="stylesheet" href="../styles/list.css">
    <title>Transportes Saquarema Ltda.</title>
</head>
<body>
    <header>
        <div class="header"><a href="../index.html"><img src="../images/icon.png" class="icon" alt="icone"></a><a href="../index.html"><span class="title1">Transportes Saquarema Ltda.</span></a><span class="title2">Encontre seu fornecedor de transporte ideal!</span></div>
    </header>
    <main class="main-list">
        <div class="search">
            <input type="text" placeholder="Pesquise o nome ou estado (UF) da transportadora..." id="search">
            <img src="../images/search.svg" alt="search" id="searchImg">
        </div>
        <div class="filtered-data">

        </div>
        <div class="list">
            <table>
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Estado</th>
                        <th>Pre√ßo por KM</th>
                        <th>E-mail</th>
                        <th>Telefone</th>
                    </tr>
                </thead>
                <tbody id="table-body"></tbody>
            </table>
        </div>
    </main>

</body>
<script>
    const apiUrl = 'http://localhost:8000/api/v1';
    let data;
    document.addEventListener('DOMContentLoaded', async function () {
        const response = await fetch(`${apiUrl}/fornecedores`)

        data = await response.json()

        const tableBody = document.getElementById('table-body');

            data.forEach((item) => {
                const row = document.createElement('tr');

                const properties = ['Nome', 'Estado', 'Preco_km', 'Email', 'Telefone'];
                properties.forEach((prop) => {
                    const cell = document.createElement('td');
                    cell.textContent = item[prop];
                    row.appendChild(cell);
                });

                tableBody.appendChild(row);
            })
    })
    const searchIcon = document.querySelector('#searchImg')
    const searchInput = document.querySelector('#search')

    searchIcon.addEventListener('click', async () => {
    const searchInputValue = searchInput.value;
    const body = {
        nome: searchInputValue.length !== 2 ? searchInputValue : "",
        estado: searchInputValue.length === 2 ? searchInputValue : ""
    };
    const param = {
        method: 'POST',
        body: JSON.stringify(body)
    };
    const response = await fetch(`${apiUrl}/fornecedor`, param);
    const filteredData = await response.json();

    const filteredDiv = document.querySelector('.filtered-data');
    filteredDiv.innerHTML = '';

    const table = document.createElement('table');

    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    const headerProperties = ['Nome', 'Estado', 'Preco por km', 'Email', 'Telefone'];
    headerProperties.forEach(prop => {
        const th = document.createElement('th');
        th.textContent = prop;
        headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);

    table.appendChild(thead);
    filteredDiv.appendChild(table);

    const tbody = document.createElement('tbody');
    filteredData.forEach(item => {
        const row = document.createElement('tr');
        const properties = ['Nome', 'Estado', 'Preco_km', 'Email', 'Telefone'];
        properties.forEach(prop => {
            const cell = document.createElement('td');
            cell.textContent = item[prop];
            row.appendChild(cell);
        });
        tbody.appendChild(row);
    });

    table.appendChild(tbody);
});

</script>
</html>