<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../styles/style.css">
    <title>Transportes Saquarema Ltda.</title>
</head>
<body>
    <header>
        <div class="header">
            <a href="../index.html"><img src="../images/icon.png" class="icon" alt="icone"></a>
            <a href="../index.html">
                <span class="title1">Transportes Saquarema Ltda.</span>
            </a>
            <span class="title2">Encontre seu fornecedor de transporte ideal!</span>
        </div>
    </header>
    <main class="maincalc">
        <p class="title3">Calcule seu frete!</p>
        <div class="calcfrete">
            <p class="transp">
                <label for="ichoice">Transportadora:</label>
                <select name="estado" id="ichoice">
                    <option value="" selected>--- Selecione uma transportadora ---</option>
                </select>
            </p>
            <p>
                <span class="dist">
                    <label for="idistance">Distância:</label>
                    <div class="linkfordist"></div>
                        <input id="idistance" class="field" type="number">

                </span>
            </p>
            <div>
                <button id="send" style="margin-left: 15px">Calcular</button>
            </div>
        </div>
        <div class="linkfordist">
            <a id="linksite" href="https://www.distanciasentrecidades.com" target="_blank">Descubra a distância entre as cidades (utilize a distância por estrada)</a>
        </div>
        <div class="result error" id="error"></div>
        <div class="result" id="result"></div>
    </main>
</body>
<script>
    const apiUrl = 'http://localhost:8000/api/v1';
    const calcButton = document.querySelector('#send');
    let data;
    document.addEventListener('DOMContentLoaded', async () => {
        const response = await fetch(`${apiUrl}/fornecedores`)
        data = await response.json()

        const select = document.querySelector('#ichoice')

        data.forEach((item) => {
            const newOption = document.createElement('option');

            select.append(newOption);
            newOption.textContent = `${item.Nome}`
        });
    })

    calcButton.addEventListener('click', async () => {
        const transportadora = document.querySelector('#ichoice').value
        const distancia = document.querySelector('#idistance').value
        const result = document.querySelector('#result')
        const errorMsg = document.querySelector('#error')
        const body = {
            nome: transportadora,
            distancia
        }
        const param = {
            method: 'POST',
            body: JSON.stringify(body)
        }

        const response = await fetch(`${apiUrl}/calcula-frete`, param)
        const sendedData = await response.json()

        if (response.ok) {
            errorMsg.textContent = ''
            result.textContent = `${sendedData.mensagem}`;
        } else {
            result.textContent = ''
            errorMsg.textContent = `${sendedData.Error}`
        }

    })
</script>
</html>